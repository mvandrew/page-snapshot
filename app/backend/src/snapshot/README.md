# Snapshot API

API для получения снимков веб-страниц от Chrome расширения.

## Эндпоинты

### POST /api/snapshot

Создает новый снимок страницы.

#### Запрос

```json
{
  "content": {
    "html": "<html>...</html>",
    "url": "https://example.com/page",
    "title": "Page Title",
    "timestamp": "2024-01-01T12:00:00.000Z"
  },
  "userAgent": "Mozilla/5.0..."
}
```

#### Ответ

**Успешный ответ (200):**
```json
{
  "success": true,
  "message": "Снимок страницы успешно получен",
  "data": {
    "id": "snapshot_abc123_def456",
    "receivedAt": "2024-01-01T12:00:01.000Z",
    "checksum": "a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456"
  }
}
```

**Ошибка валидации (400):**
```json
{
  "success": false,
  "message": "Ошибка обработки снимка: [описание ошибки]"
}
```

**Ошибка сохранения (500):**
```json
{
  "success": false,
  "message": "Не удалось сохранить снимок: [описание ошибки]"
}
```

## Структура данных

### Content
- `html` (string) - Полный HTML код страницы
- `url` (string) - URL страницы
- `title` (string) - Заголовок страницы
- `timestamp` (string) - Временная метка создания снимка

### Основные поля
- `userAgent` (string) - Информация о браузере

## Валидация

- Все поля обязательны
- URL должен быть валидным
- Timestamp должен быть в формате ISO 8601
- HTML должен быть непустой строкой

## Контрольная сумма

Для каждого снимка вычисляется SHA-256 хэш на основе:
- HTML контента страницы
- URL страницы
- Заголовка страницы
- Временной метки создания
- User Agent браузера

Контрольная сумма возвращается в поле `data.checksum` и может использоваться для:
- Проверки целостности данных
- Обнаружения дубликатов
- Верификации неизменности контента

## Логирование

Сервис логирует:
- URL полученной страницы
- Размер HTML контента
- User Agent
- Временные метки
- Контрольную сумму
- Ошибки валидации

## Сохранение файлов

Снимки сохраняются напрямую в корневую папку:

```
{SNAPSHOT_STORAGE_PATH}/
├── index.html    # Исходный код страницы
└── data.json     # Метаданные без HTML
```

### Структура data.json:
```json
{
  "id": "snapshot_abc123_def456",
  "url": "https://example.com/page",
  "title": "Page Title",
  "timestamp": "2024-01-01T12:00:00.000Z",
  "userAgent": "Mozilla/5.0...",
  "checksum": "a1b2c3d4e5f6...",
  "receivedAt": "2024-01-01T12:00:01.000Z",
  "htmlSize": 12345
}
```

### Логика обновления:
- Если папка сохранения не существует → создается
- Если файл data.json не существует → создается новый снимок
- Если файл data.json существует → проверяется контрольная сумма
- Если контрольная сумма отличается → файлы перезаписываются
- Если контрольная сумма совпадает → файлы не изменяются

## TODO

- [ ] Обработка HTML контента
- [ ] Извлечение метаданных
- [ ] Сжатие больших HTML
- [ ] Анализ содержимого
- [ ] Архивирование старых снимков
