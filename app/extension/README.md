# Page Snapshot Chrome Extension

# Назначение

Расширение Google Chrome «Page Snapshot» по явному клику пользователя снимает максимально точную копию текущего состояния страницы (полный DOM/исходный HTML) и отправляет её вместе с URL на ваш REST API endpoint в формате JSON.

# Объём (Scope)

* Браузер: Chrome (Manifest V3).
* Триггер: только по действию пользователя (клик по иконке/пункт контекстного меню).
* Данные: текущий URL активной вкладки и полный HTML (`document.documentElement.outerHTML`) в момент клика.
* Транспорт: `POST` JSON на указанный вами endpoint (HTTPS).
* Конфигурация: endpoint URL и (опционально) ключ авторизации задаются в настройках расширения.

# Что не входит (Out of scope)

* Любая фильтрация, маскирование или редактирование содержимого страницы — **не требуется**.
* Непрозрачные фоновые сборы без действия пользователя — **не используются**.
* Хранение собранного HTML локально — **не предусматривается** (кроме кратковременного буфера на время отправки).

# Формат отправляемых данных (JSON)

* `content`: объект — содержит данные о содержимом страницы:
  * `html`: строка — полный сериализованный HTML текущего DOM.
  * `url`: строка — полный URL активной страницы.
  * `title`: строка — заголовок страницы (document.title).
  * `timestamp`: строка — временная метка создания снимка в ISO формате.
* `userAgent`: строка — User Agent браузера.

Пример:

```json
{
  "content": {
    "html": "<!doctype html><html lang=\"...\">...</html>",
    "url": "https://example.com/page",
    "title": "Заголовок страницы",
    "timestamp": "2024-01-15T10:30:00.000Z"
  },
  "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36..."
}
```

# Пользовательские сценарии

1. Пользователь открывает страницу → нажимает на иконку расширения → данные (URL, HTML, title, timestamp, userAgent) отправляются на сервер → показывается уведомление об успехе/ошибке.
2. (Опция) Правый клик по странице → «Export current page DOM» → отправка и уведомление.

# UX/поведение

* Минимум интерфейса: иконка в тулбаре, всплывающее уведомление о статусе («Отправлено»/код ошибки).
* В настройках — поле для `Endpoint URL`.

# Разрешения (минимально необходимые)

* `activeTab` — доступ к активной вкладке по клику.
* `scripting` — внедрение контент-скрипта для чтения DOM.
* `storage` — хранение настроек (endpoint URL).
* `notifications` — уведомления о результате.
* (Опция) `contextMenus` — пункт в контекстном меню.

# Безопасность и соединение

* Рекомендуется HTTPS endpoint (TLS).
* Так как сервер ваш и данные приватные, дополнительная редакция/маскирование содержимого **не выполняется**.

# Производительность и ограничения

* Большие страницы ⇒ большой payload. Рекомендуется:

  * Принимать на сервере тела от нескольких мегабайт и выше.
  * (Опция) Включить сжатие на стороне клиента/сервера (например, `Content-Encoding: gzip`) — по желанию.
* Состояние DOM фиксируется «как есть» в момент клика; для SPA это отражает текущий рендер.

# Обработка ошибок

* Сетевые/серверные ошибки: сообщение пользователю + код статуса.
* Без повторных фоновых попыток, чтобы не создавать «тихих» повторов без явного запроса пользователя (держим поведение простым и прогнозируемым).

# Конфигурация

* `Endpoint URL` — обязателен.
* **ВАЖНО**: Настройки сохраняются при обновлении расширения и не сбрасываются при получении новой версии.
* Сброс/проверка настроек — в экране настроек расширения.

# Критерии приёмки

1. По клику отправляется один `POST` на указанный endpoint с полями `content` (содержащим `html`, `url`, `title`, `timestamp`) и `userAgent`.
2. `content.html` содержит полный текущий DOM страницы (включая динамически изменённые элементы).
3. `content.timestamp` содержит корректную временную метку в ISO формате.
4. Пользователь получает понятное уведомление об успехе/ошибке.
5. Никакой фильтрации/маскирования контента не происходит.
6. Расширение работает только по явному действию пользователя и использует минимальные разрешения.
