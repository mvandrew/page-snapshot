# Page Snapshot Chrome Extension

# Назначение

Расширение Google Chrome «Page Snapshot» по явному клику пользователя снимает максимально точную копию текущего состояния страницы (полный DOM/исходный HTML) и отправляет её вместе с URL на ваш REST API endpoint в формате JSON.

# Объём (Scope)

* Браузер: Chrome (Manifest V3).
* Триггер: только по действию пользователя (клик по иконке/пункт контекстного меню).
* Данные: текущий URL активной вкладки и полный HTML (`document.documentElement.outerHTML`) в момент клика.
* Транспорт: `POST` JSON на указанный вами endpoint (HTTPS).
* Конфигурация: endpoint URL и (опционально) ключ авторизации задаются в настройках расширения.

# Что не входит (Out of scope)

* Любая фильтрация, маскирование или редактирование содержимого страницы — **не требуется**.
* Непрозрачные фоновые сборы без действия пользователя — **не используются**.
* Хранение собранного HTML локально — **не предусматривается** (кроме кратковременного буфера на время отправки).

# Формат отправляемых данных (JSON)

* `url`: строка — полный URL активной страницы.
* `html`: строка — полный сериализованный HTML текущего DOM.

Пример:

```json
{
  "url": "https://example.com/page",
  "html": "<!doctype html><html lang=\"...\">...</html>"
}
```

# Пользовательские сценарии

1. Пользователь открывает страницу → нажимает на иконку расширения → данные (URL, HTML) отправляются на сервер → показывается уведомление об успехе/ошибке.
2. (Опция) Правый клик по странице → «Export current page DOM» → отправка и уведомление.

# UX/поведение

* Минимум интерфейса: иконка в тулбаре, всплывающее уведомление о статусе («Отправлено»/код ошибки).
* В настройках — поля для `Endpoint URL` и, при необходимости, `API Key`.

# Разрешения (минимально необходимые)

* `activeTab` — доступ к активной вкладке по клику.
* `scripting` — внедрение контент-скрипта для чтения DOM.
* `storage` — хранение настроек (endpoint и ключ).
* `notifications` — уведомления о результате.
* (Опция) `contextMenus` — пункт в контекстном меню.

# Безопасность и соединение

* Рекомендуется HTTPS endpoint (TLS).
* Если используется авторизация — отправка ключа в заголовке (например, `Authorization: Bearer …`).
* Так как сервер ваш и данные приватные, дополнительная редакция/маскирование содержимого **не выполняется**.

# Производительность и ограничения

* Большие страницы ⇒ большой payload. Рекомендуется:

  * Принимать на сервере тела от нескольких мегабайт и выше.
  * (Опция) Включить сжатие на стороне клиента/сервера (например, `Content-Encoding: gzip`) — по желанию.
* Состояние DOM фиксируется «как есть» в момент клика; для SPA это отражает текущий рендер.

# Обработка ошибок

* Сетевые/серверные ошибки: сообщение пользователю + код статуса.
* Без повторных фоновых попыток, чтобы не создавать «тихих» повторов без явного запроса пользователя (держим поведение простым и прогнозируемым).

# Конфигурация

* `Endpoint URL` — обязателен.
* `API Key` — опционально (если сервер требует).
* Сброс/проверка настроек — в экране настроек расширения.

# Критерии приёмки

1. По клику отправляется один `POST` на указанный endpoint с полями `url` и `html`.
2. `html` содержит полный текущий DOM страницы (включая динамически изменённые элементы).
3. Пользователь получает понятное уведомление об успехе/ошибке.
4. Никакой фильтрации/маскирования контента не происходит.
5. Расширение работает только по явному действию пользователя и использует минимальные разрешения.
