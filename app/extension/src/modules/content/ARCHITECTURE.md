# Архитектура Content Script модулей

## Общая схема

```
┌─────────────────────────────────────────────────────────────┐
│                    CONTENT SCRIPT                           │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              ContentController                      │   │
│  │           (Главный координатор)                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                │
│  ┌────────────────────────┼────────────────────────┐      │
│  │                        │                        │      │
│  ▼                        ▼                        ▼      │
│  ┌─────────────────┐    ┌─────────────────┐    ┌──────────┐│
│  │ PageInfoCollector│    │ AutoSaveManager │    │ElementHighlighter│
│  │                 │    │                 │    │          ││
│  │ • Сбор HTML     │    │ • Периодическое │    │ • Подсветка│
│  │ • Метаданные    │    │   сохранение    │    │ • Навигация│
│  │ • Валидация     │    │ • Проверка      │    │ • Поиск   │
│  │ • Статистика    │    │   изменений     │    │ • Селекторы│
│  └─────────────────┘    └─────────────────┘    └──────────┘│
│                           │                        │      │
│  ┌────────────────────────┼────────────────────────┐      │
│  │                        │                        │      │
│  ▼                        ▼                        ▼      │
│  ┌─────────────────┐    ┌─────────────────┐    ┌──────────┐│
│  │NotificationManager│   │ContentProcessor │    │  Logger  ││
│  │                 │    │   (Legacy)      │    │          ││
│  │ • Уведомления   │    │ • Обработка     │    │ • Логи   │
│  │ • Анимации      │    │   контента      │    │ • Ошибки │
│  │ • Позиционирование│   │ • Сжатие       │    │ • Отладка│
│  └─────────────────┘    └─────────────────┘    └──────────┘│
└─────────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                 CHROME RUNTIME API                          │
│  ┌─────────────────┐    ┌─────────────────┐                │
│  │   Background    │    │     Popup       │                │
│  │     Script      │    │     Script      │                │
│  └─────────────────┘    └─────────────────┘                │
└─────────────────────────────────────────────────────────────┘
```

## Поток данных

### 1. Инициализация
```
content.js → ContentController → Инициализация всех модулей
```

### 2. Сбор информации о странице
```
PageInfoCollector → HTML + метаданные → ContentController
```

### 3. Автоматическое сохранение
```
AutoSaveManager → PageInfoCollector → Background Script
```

### 4. Подсветка элементов
```
Popup → ContentController → ElementHighlighter → DOM
```

### 5. Уведомления
```
Любой модуль → NotificationManager → DOM уведомления
```

## Взаимодействие модулей

### ContentController (Центральный хаб)
- **Инициализирует** все модули
- **Координирует** их работу
- **Обрабатывает** сообщения от popup/background
- **Управляет** жизненным циклом

### PageInfoCollector (Сбор данных)
- **Предоставляет** информацию о странице
- **Валидирует** данные
- **Отслеживает** изменения
- **Создает** статистику

### AutoSaveManager (Автосохранение)
- **Использует** PageInfoCollector для получения данных
- **Управляет** таймерами
- **Обрабатывает** ошибки
- **Отправляет** данные в Background

### ElementHighlighter (Визуализация)
- **Работает** с DOM
- **Создает** визуальные эффекты
- **Обрабатывает** пользовательские действия
- **Генерирует** селекторы

### NotificationManager (UI уведомления)
- **Создает** уведомления в DOM
- **Управляет** анимациями
- **Контролирует** жизненный цикл уведомлений
- **Поддерживает** различные типы

## Преимущества модульной архитектуры

### 1. Разделение ответственности
- Каждый модуль отвечает за свою область
- Четкие границы между функциональностью
- Легко понять назначение каждого компонента

### 2. Переиспользование
- Модули можно использовать независимо
- Легко тестировать отдельные компоненты
- Возможность создания новых комбинаций

### 3. Масштабируемость
- Легко добавлять новые модули
- Минимальное влияние на существующий код
- Гибкая конфигурация

### 4. Отладка и поддержка
- Изолированные ошибки
- Четкие точки входа для отладки
- Простое логирование

### 5. Производительность
- Ленивая загрузка модулей
- Оптимизированная работа с DOM
- Минимальное потребление памяти

## Ограничения и особенности

### Content Script ограничения
- Нет прямого доступа к Chrome Extension API
- Взаимодействие только через сообщения
- Ограниченный доступ к файловой системе
- Зависимость от контекста страницы

### Модульная архитектура
- Модули загружаются через importScripts
- Все модули должны быть доступны в self/window
- Строгая последовательность загрузки
- Обработка ошибок инициализации

## Рекомендации по развитию

### 1. Добавление новых модулей
- Следуйте существующим паттернам
- Обеспечьте совместимость с ContentController
- Добавьте соответствующие тесты
- Обновите документацию

### 2. Оптимизация производительности
- Минимизируйте DOM операции
- Используйте debouncing для частых операций
- Кэшируйте результаты вычислений
- Очищайте ресурсы при необходимости

### 3. Улучшение отладки
- Добавляйте детальное логирование
- Создавайте диагностические методы
- Предоставляйте статистику работы
- Обеспечьте graceful degradation
